{{ if eq .Values.type "cloudwatch" }}
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: cloudwatch-scaledobject-{{ .Values.suffix }}
  namespace: {{ .Release.Namespace }}
spec:
  scaleTargetRef:
    apiVersion: {{ .Values.scaleTargetRef.apiVersion }}  # Optional. Default: apps/v1
    kind: {{ .Values.scaleTargetRef.kind }}         # Optional. Default: Deployment
    name: {{ .Values.scaleTargetRef.name }}        # Mandatory. Must be in the same namespace as the ScaledObject
    envSourceContainerName: {{ .Values.scaleTargetRef.envSourceContainerName }}        # Optional. Default: .spec.template.spec.containers[0]
  pollingInterval:  {{ .Values.pollingInterval }}                               # Optional. Default: 30 seconds
  cooldownPeriod:   {{ .Values.cooldownPeriod }}                              # Optional. Default: 300 seconds
  idleReplicaCount: {{ .Values.idleReplicaCount }}                               # Optional. Default: ignored, must be less than minReplicaCount
  minReplicaCount:  {{ .Values.minReplicaCount }}                                # Optional. Default: 0
  maxReplicaCount:  {{ .Values.maxReplicaCount }}                              # Optional. Default: 100
#  fallback:                                          # Optional. Section to specify fallback options
#    failureThreshold: {{ .Values.fallback.failureThreshold }}                              # Mandatory if fallback section is included
#    replicas: {{ .Values.fallback.replicas }}                                     # Mandatory if fallback section is included
  advanced:                                          # Optional. Section to specify advanced options
    restoreToOriginalReplicaCount: {{ .Values.behavior.restoreToOriginalReplicaCount }}        # Optional. Default: false
    horizontalPodAutoscalerConfig:                   # Optional. Section to specify HPA related options
      behavior:                                      # Optional. Use to modify HPA's scaling behavior
        scaleDown:
          stabilizationWindowSeconds: {{ .Values.behavior.stabilizationWindowSeconds }}
          policies:
          - type: {{ .Values.behavior.type }}
            value: {{ .Values.behavior.value }}
            periodSeconds: {{ .Values.behavior.periodSeconds }}
  triggers:
    - type: aws-cloudwatch
      metadata:
        # Required: namespace
        namespace: {{ .Values.triggers.namespace }}
        # Required: Dimension Name - Supports specifying multiple dimension names by using ";" as a separator i.e. dimensionName: QueueName;QueueName
        dimensionName: Broker;Queue
        # Required: Dimension Value - Supports specifying multiple dimension values by using ";" as a separator i.e. dimensionValue: queue1;queue2
        #dimensionValue: {{ .Values.triggers.brokerName }};{{ .Values.triggers.queueName }}
        dimensionValue: armonik-mq-damdou-1;{{ .Values.triggers.queueName }}
        metricName: {{ .Values.triggers.metricName }}
        targetMetricValue: {{ .Values.triggers.targetMetricValue | quote }}
        minMetricValue: {{ .Values.triggers.minMetricValue | quote }}
        # Required: region
        awsRegion: {{ .Values.triggers.awsRegion }}
        identityOwner: operator  # Optional. Default: pod or operator
        # Optional: Collection Time
        metricCollectionTime: {{ .Values.triggers.metricCollectionTime | quote }} # default 300
        # Optional: Metric Statistic
        metricStat: "Average" # default "Average"
        # Optional: Metric Statistic Period
        metricStatPeriod: {{ .Values.triggers.metricStatPeriod | quote }} # default 300
        # Optional: Metric Unit
        metricUnit: "Count" # default ""
        # Optional: Metric EndTime Offset
        metricEndTimeOffset: {{ .Values.triggers.metricEndTimeOffset | quote }} # default 0
      #authenticationRef:
      #  name: trigger-auth-cloudwatch
{{ end }}